# JavaScript 的预编译过程分析

## 一、JavaScript 概念

JavaScript ( JS ) 是一个单线程、解释型的编程语言。

## 二、JavaScript 语言特点

### 2.1 单线程

JavaScript 语言的一大特点就是单线程，也就是说，同一个时间只能做一件事。

### 2.2 解释型语言

自上而下，解释一行，执行一行；不会通篇编译为一个文件再执行。

## 三、 JavaScript 执行过程

### 3.1 语法分析

顾名思义 就是检查一遍 js 代码内有没有出现语法错误（比如少些个分号，多写个括号等）；语法分析期间不会执行代码

### 3.2 预编译

**预编译发生在函数执行的前一刻**
**全局下：**
全局的变量声明和函数声明则会存放在全局对象内（Global Object 简称 GO，它是 window 的一部分，你可以直接把他理解成 window 对象）中
**函数体内：**
预编译会提前把函数里的变量声明和函数声明依据规则存放在该活动对象内（Activation Object，简称 AO），

预编译简单理解就是在内存中开辟一些空间，存放一些变量与函数 。

预编译大致可分为 4 步：

1. 创建 AO(GO)对象
2. 找形参和变量声明，将形参和变量名作为 AO(GO)属性名，值为 undefined
3. 将实参值和形参统一
4. 在函数体里面找函数声明，值赋予函数体。

所以如果遇到下面这种情况，当函数声明和变量声明名称相同时：

```js
console.log(a);
var a = 1;
function a() {}
```

编译后的代码其实是：

```js
var a;
function a() {}
console.log(a);
a = 1;
```

所以最后输出的是：

```js
function a() {}
```

#### 预编译小节

**预编译两个小规则**

1. 函数声明整体提升—(具体点说，无论函数调用和声明的位置是前是后，系统总会把函数声明移到调用前面）
2. 变量 声明提升—(具体点说，无论变量调用和声明的位置是前是后，系统总会把声明移到调用前，注意仅仅只是声明，所以值是 undefined），只有在解释执行阶段才会进行变量初始化，匿名函数不参与预编译。

**预编译前奏**

1. imply global 即任何变量，如果未经声明就赋值，则此变量就位全局变量所有(全局域就是 window) 。
2. 一切声明的全局变量，全是 window 的属性。

```js
<script>var a=2; console.log(window.a);//2</script>
```

### 3.3 解释执行

预编译完毕之后，JavaScript 脚本开始执行，执行顺序按照从上到下的顺序执行。

## 总结

**JavaScript 执行顺序**

1. 语法分析
2. 预编译  
   2.1. 创建 AO(GO)对象  
   2.2. 找形参和变量声明，将形参和变量名作为 AO(GO)属性名，值为 undefined  
   2.3. 将实参值和形参统一  
   2.4. 在函数体里面找函数声明，值赋予函数体。
3. 解释执行

练习：

```js
function a(a) {
  console.log(a);
  a = 2;
  console.log(b);
  var b = 3;
  console.log(a);
}
a(1);
console.log(a);
```

你可以先试想一下结果，然后复制代码到控制台去验证你的答案是否正确。
