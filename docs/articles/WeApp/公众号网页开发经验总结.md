# 公众号网页开发经验总结

## 内网穿透

- sunny-Ngrok：https://www.ngrok.cc/

- 修改 webpack-dev-serverdisableHostCheck: true

## 移动端调试

- VConsole：https://github.com/Tencent/vConsole

## 微信公众号开发文档

- [公众号开发文档](https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html3)
- [JS-WX-SDK 文档](https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html)

## 如何让网页只在微信内打开

1. 通过 userAgent 判断

   ```js
   // 判断是否是微信环境
   function getIsWxClient() {
     var ua = navigator.userAgent.toLowerCase();
     if (ua.match(/MicroMessenger/i) == "micromessenger") {
       return true;
     }
     return false;
   }
   ```

2) 通过 WeixinJSBridge 判断(推荐)

   ```js
   // 需要在JS-SDK加载之后判断
   function getIsWxClient() {
     if (typeof WeixinJSBridge !== "undefined") {
       return true;
     } else {
       return false;
     }
   }
   ```

## 公众号内保持登录状态

微信内网页不可使用 local/sessionStorage 储存，因为它只是一个 webview 组件，并不是一个浏览器。
可以使用 cookie 储存的方式
参考：关于微信中的 localStorage 及使用 cookie 的解决方案：https://www.cnblogs.com/toggle/p/9376997.html
方法：

```js
//设置cookie
function setCookie(c_name, value, expiredays) {
  var exdate = new Date();
  exdate.setDate(exdate.getDate() + expiredays);
  document.cookie =
    c_name +
    "=" +
    escape(value) +
    (expiredays == null ? "" : ";expires=" + exdate.toGMTString());
}

//取回cookie
function getCookie(c_name) {
  if (document.cookie.length > 0) {
    c_start = document.cookie.indexOf(c_name + "=");
    if (c_start != -1) {
      c_start = c_start + c_name.length + 1;
      c_end = document.cookie.indexOf(";", c_start);
      if (c_end == -1) c_end = document.cookie.length;
      return unescape(document.cookie.substring(c_start, c_end));
    }
  }
  return "";
}
```

使用

```js
//设置cookie，有效期为365天
setCookie("username", "123", 365);

//取回，若cookie失效，将返回空
getCookie("username");
```

## 扫码关注公众号登录

https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_event_pushes.html
